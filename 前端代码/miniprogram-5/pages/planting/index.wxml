<view class="page-container">
    <view class="header">
        <view class="title">种植录入</view>
        <view class="desc">录入药材在田间的日常操作与生长情况</view>
    </view>

    <view class="card">
        <view class="section-title">当前批次</view>
        <picker mode="selector" range="{{batches}}" range-key="batchNo" value="{{batchIndex}}" bindchange="onBatchChange">
            <view class="picker-row">
                <view class="picker-label">批次号</view>
                <view class="picker-value">{{currentBatch ? currentBatch.batchNo : '暂无批次（请先创建批次）'}}</view>
            </view>
        </picker>
        <view class="batch-meta" wx:if="{{currentBatch}}">
            <view class="batch-line">名称：{{currentBatch.name || '-'}}</view>
            <view class="batch-line">产地：{{currentBatch.origin || '-'}}</view>
            <view class="batch-line">状态：{{currentBatch.status || '-'}}</view>
            <view class="batch-line" wx:if="{{currentBatch.gs1Code}}">GS1：{{currentBatch.gs1Code}}</view>
        </view>
    </view>

    <view class="card">
        <view class="section-title">记录列表</view>
        <view class="search-bar">
            <input class="input-inline" placeholder="输入ID/地块/操作/操作人查询" value="{{queryKey}}" bindinput="onQueryInput" />
            <button class="btn-small" bindtap="query">查询</button>
        </view>
        <view class="btn-group">
            <button class="btn btn-primary" bindtap="startCreate">新建记录</button>
            <button class="btn btn-outline" bindtap="refresh">刷新列表</button>
        </view>
        <view class="meta" wx:if="{{lastUpdatedAt}}">
            最近刷新: {{lastUpdatedAt}}
        </view>
        <view class="empty" wx:if="{{!loading && records.length === 0}}">
            暂无数据，可以点击“新建记录”开始录入。
        </view>
        <view class="list" wx:if="{{records.length > 0}}">
            <view class="list-item" wx:for="{{records}}" wx:key="id" bindtap="editFromList" data-id="{{item.id}}">
                <view class="list-main">
                    <view class="list-title">
                        #{{item.id}} · {{item.operation || '未填写操作'}}
                    </view>
                    <view class="list-sub">
                        批次: {{item.batchNo || '-'}} · 地块: {{item.fieldName || '-'}} · 操作人: {{item.operator || '-'}}
                    </view>
                    <view class="list-meta" wx:if="{{item.createdAtText}}">
                        创建: {{item.createdAtText}}
                    </view>
                </view>
                <view class="list-action">编辑</view>
            </view>
        </view>
    </view>
</view>
