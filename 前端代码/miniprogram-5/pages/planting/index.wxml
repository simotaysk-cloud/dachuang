<view class="page-container">
    <view class="header">
        <view class="title">种植录入</view>
        <view class="desc">录入药材在田间的日常操作与生长情况</view>
    </view>
    <view class="card">
        <view class="section-title">记录列表</view>
        <view class="stat-row">
            <view class="stat-item">
                <view class="stat-value">{{records.length}}</view>
                <view class="stat-label">已录入条数</view>
            </view>
            <view class="stat-item">
                <view class="stat-value">{{loading ? '加载中' : '就绪'}}</view>
                <view class="stat-label">接口状态</view>
            </view>
        </view>
        <view class="meta" wx:if="{{lastUpdatedAt}}">
            最近刷新: {{lastUpdatedAt}}
        </view>
        <view class="search-bar">
            <input class="input-inline" placeholder="按 batchNo 筛选（可空）" value="{{filterBatchNo}}" bindinput="onFilterInput" />
            <button class="btn-small" bindtap="refresh">刷新</button>
        </view>
        <view class="btn-group">
            <button class="btn btn-primary" bindtap="startCreate">新建记录</button>
            <button class="btn btn-outline" bindtap="refresh">重新拉取</button>
        </view>
        <view class="empty" wx:if="{{!loading && records.length === 0}}">
            暂无数据，可以点击“新建记录”开始录入。
        </view>
        <view class="list" wx:if="{{records.length > 0}}">
            <view class="list-item" wx:for="{{records}}" wx:key="id" bindtap="editFromList" data-id="{{item.id}}">
                <view class="list-main">
                    <view class="list-title">
                        #{{item.id}} · {{item.operation || '未填写操作'}}
                    </view>
                    <view class="list-sub">
                        批次: {{item.batchNo || '-'}} · 地块: {{item.fieldName || '-'}} · 操作人: {{item.operator || '-'}}
                    </view>
                    <view class="list-meta" wx:if="{{item.createdAtText}}">
                        创建: {{item.createdAtText}}
                    </view>
                </view>
                <view class="list-action">编辑</view>
            </view>
        </view>
    </view>

    <view class="card" wx:if="{{showForm}}">
        <view class="section-title">新建/编辑</view>
        <input class="input" placeholder="记录ID（编辑用）" value="{{form.id}}" data-field="id" bindinput="onInput" />
        <input class="input" placeholder="对应批次号 (batchNo)" value="{{form.batchNo}}" data-field="batchNo" bindinput="onInput" />
        <input class="input" placeholder="地块名称 (fieldName)" value="{{form.fieldName}}" data-field="fieldName" bindinput="onInput" />
        <input class="input" placeholder="操作类型 (施肥、灌溉、采收...)" value="{{form.operation}}" data-field="operation" bindinput="onInput" />
        <input class="input" placeholder="操作人 (operator)" value="{{form.operator}}" data-field="operator" bindinput="onInput" />
        <view class="section-title" style="margin-top:20rpx">多媒体附件</view>
        <input class="input" placeholder="图片链接 (imageUrl)" value="{{form.imageUrl}}" data-field="imageUrl" bindinput="onInput" />
        <input class="input" placeholder="语音链接 (audioUrl)" value="{{form.audioUrl}}" data-field="audioUrl" bindinput="onInput" />
        <textarea class="textarea" placeholder="详细描述 (details)" value="{{form.details}}" data-field="details" bindinput="onInput" />
        <view class="btn-group">
            <button class="btn btn-primary" bindtap="save">保存</button>
            <button class="btn btn-warn" bindtap="remove">删除</button>
        </view>
        <button class="btn btn-outline" style="margin-top:20rpx" bindtap="cancelEdit">收起</button>
    </view>
</view>
