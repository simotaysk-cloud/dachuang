<view class="page-container">
    <!-- Hero Header -->
    <view wx:if="{{report}}" class="hero-section" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.7)), url({{report.batch.imageUrl || 'https://picsum.photos/seed/herb_fallback/800/600'}})">
        <view class="hero-content">
            <view class="product-badge">
                <text class="badge-icon">ğŸ›¡ï¸</text>
                <text>åŒºå—é“¾å…¨ç¨‹æº¯æº</text>
            </view>
            <view class="hero-name">{{report.batch.name || 'æ™ºæ±‡æº¯æº'}}</view>
            <view class="hero-tags">
                <text class="hero-tag">{{report.batch.category}}</text>
                <text class="hero-tag">é“åœ°è¯æ</text>
            </view>
        </view>
    </view>
    <!-- Query Section (Floating) - Hidden for scanned view to keep it focused -->
    <view wx:if="{{!isScanned}}" class="search-floating {{report ? 'has-report' : ''}}">
        <view class="search-bar">
            <input class="input-inline" placeholder="è¾“å…¥æ‰¹æ¬¡å·æŸ¥è¯¢æº¯æºæ¡£æ¡ˆ" value="{{batchNo}}" bindinput="onInput" />
            <view class="query-btn" bindtap="query">
                <text>å›æº¯</text>
            </view>
        </view>
    </view>
    <view wx:if="{{report}}" class="content-body animated fadeIn">
        <!-- Summary Card -->
        <view class="card summary-card">
            <view class="section-title">
                <text class="title-text">äº§å“æ¦‚è§ˆ</text>
                <text class="origin-tag">äº§è‡ªï¼š{{report.batch.origin}}</text>
            </view>
            <view class="summary-desc">{{report.batch.description}}</view>
            <view class="gs1-box">
                <view class="gs1-label">GS1 è¿½æº¯è¯†åˆ«ç </view>
                <view class="gs1-code">{{report.gs1}}</view>
            </view>
        </view>
        <!-- Medicinal Encyclopedia Section -->
        <view class="section-header">
            <view class="header-line"></view>
            <text class="header-text">è¯æç™¾ç§‘</text>
            <view class="header-line"></view>
        </view>
        <view class="card wiki-card">
            <view class="wiki-section">
                <view class="wiki-title">
                    <text class="wiki-icon">ğŸµ</text>
                    <text>æœç”¨å»ºè®®</text>
                </view>
                <view class="wiki-content">{{report.batch.usageAdvice || 'æš‚æ— æœç”¨å»ºè®®'}}</view>
            </view>
            <view class="wiki-section">
                <view class="wiki-title warning">
                    <text class="wiki-icon">âš ï¸</text>
                    <text>ç¦å¿Œè¯´æ˜</text>
                </view>
                <view class="wiki-content">{{report.batch.contraindications || 'æš‚æ— ç¦å¿Œè¯´æ˜'}}</view>
            </view>
            <view class="wiki-section">
                <view class="wiki-title pairing">
                    <text class="wiki-icon">ğŸ§ª</text>
                    <text>å¸¸è§é…ä¼</text>
                </view>
                <view class="wiki-content">
                    <view class="pairing-item" wx:for="{{report.pairings}}" wx:key="index">
                        {{item}}
                    </view>
                    <view wx:if="{{!report.pairings || report.pairings.length === 0}}">
                        æš‚æ— ç›¸å…³é…ä¼æ¨è
                    </view>
                </view>
            </view>
        </view>
        <!-- Traceability Timeline Section -->
        <view class="section-header">
            <view class="header-line"></view>
            <text class="header-text">ç”Ÿå‘½å‘¨æœŸå›æº¯</text>
            <view class="header-line"></view>
        </view>
        <view class="timeline-container">
            <view class="timeline-item {{item.isHighlight ? 'highlight' : ''}}" wx:for="{{report.timeline}}" wx:key="index">
                <view class="item-left">
                    <view class="time-main">{{item.tag}}</view>
                    <view class="time-sub">{{item.timeDisplay}}</view>
                </view>
                <view class="item-dot">
                    <view class="dot-inner">{{item.icon}}</view>
                </view>
                <view class="item-content card">
                    <view class="line-badge" wx:if="{{item.lineName}}">{{item.lineName}}</view>
                    <view class="content-title">{{item.title}}</view>
                    <view class="content-detail">{{item.details}}</view>
                </view>
            </view>
        </view>
        <!-- Safety Footer -->
        <view wx:if="{{report}}" class="safety-footer">
            <view class="seal-logo">æ™ºæ±‡ Â· æœ¬è‰</view>
            <view class="safety-tips">æœ¬æŠ¥å‘Šç”±åŒºå—é“¾æº¯æºç³»ç»Ÿåº•å±‚æ”¯æ’‘ï¼Œä¿éšœæ•°æ®çœŸå®ä¸å¯ç¯¡æ”¹</view>
            <view class="report-id">æŠ¥å‘Šå”¯ä¸€æ ‡è¯†ï¼š{{report.batch.batchNo}}</view>
        </view>
    </view>
    <!-- Initial State -->
    <view class="initial-state" wx:if="{{!report && !loading}}">
        <view class="hero-placeholder">
            <view class="placeholder-icon">ğŸŒ±</view>
        </view>
        <view class="placeholder-text">æ¯ä¸€æ ªè‰æœ¬ï¼Œéƒ½æœ‰å®ƒçš„æ•…äº‹</view>
    </view>
</view>