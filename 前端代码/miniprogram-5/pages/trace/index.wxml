<view class="page-container">
    <!-- Hero Header -->
    <view wx:if="{{report}}" class="hero-section" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.7)), url({{report.batch.imageUrl || 'https://picsum.photos/seed/herb_fallback/800/600'}})">
        <view class="hero-content">
            <view class="product-badge">
                <text class="badge-icon">溯</text>
                <text>区块链全程溯源</text>
            </view>
            <view class="hero-name">{{report.batch.name || '智汇溯源'}}</view>
            <view class="hero-tags">
                <text class="hero-tag">{{report.batch.category}}</text>
                <text class="hero-tag">道地药材</text>
            </view>
        </view>
    </view>
    <!-- Query Section (Floating) - Hidden for scanned view to keep it focused -->
    <view wx:if="{{!isScanned}}" class="search-floating {{report ? 'has-report' : ''}}">
        <view class="search-bar">
            <input class="input-inline" placeholder="输入批次号查询溯源档案" value="{{batchNo}}" bindinput="onInput" />
            <view class="query-btn" bindtap="query">
                <text>回溯</text>
            </view>
        </view>
    </view>
    <view wx:if="{{report}}" class="content-body animated fadeIn">
        <!-- Summary Card -->
        <view class="card summary-card">
            <view class="section-title">
                <text class="title-text">产品概览</text>
                <text class="origin-tag">产自：{{report.batch.origin}}</text>
            </view>
            <view class="summary-desc">{{report.batch.description}}</view>
            <view class="gs1-box">
                <view class="gs1-label">GS1 追溯识别码</view>
                <view class="gs1-code">{{report.gs1}}</view>
            </view>
        </view>
        <!-- Medicinal Encyclopedia Section -->
        <view class="section-header">
            <view class="header-line"></view>
            <text class="header-text">药材百科</text>
            <view class="header-line"></view>
        </view>
        <view class="card wiki-card">
            <view class="wiki-section">
                <view class="wiki-title">
                    <text class="wiki-icon">建</text>
                    <text>服用建议</text>
                </view>
                <view class="wiki-content">{{report.batch.usageAdvice || '暂无服用建议'}}</view>
            </view>
            <view class="wiki-section">
                <view class="wiki-title warning">
                    <text class="wiki-icon">注</text>
                    <text>禁忌说明</text>
                </view>
                <view class="wiki-content">{{report.batch.contraindications || '暂无禁忌说明'}}</view>
            </view>
            <view class="wiki-section">
                <view class="wiki-title pairing">
                    <text class="wiki-icon">配</text>
                    <text>常见配伍</text>
                </view>
                <view class="wiki-content">
                    <view class="pairing-item" wx:for="{{report.pairings}}" wx:key="index">
                        {{item}}
                    </view>
                    <view wx:if="{{!report.pairings || report.pairings.length === 0}}">
                        暂无相关配伍推荐
                    </view>
                </view>
            </view>
        </view>
        <!-- Traceability Timeline Section -->
        <view class="section-header">
            <view class="header-line"></view>
            <text class="header-text">生命周期回溯</text>
            <view class="header-line"></view>
        </view>
        <view class="timeline-container">
            <view class="timeline-item {{item.isHighlight ? 'highlight' : ''}}" wx:for="{{report.timeline}}" wx:key="index">
                <view class="item-left">
                    <view class="time-main">{{item.tag}}</view>
                    <view class="time-sub">{{item.timeDisplay}}</view>
                </view>
                <view class="item-dot">
                    <view class="dot-inner">{{item.icon}}</view>
                </view>
                <view class="item-content card">
                    <view class="line-badge" wx:if="{{item.lineName}}">{{item.lineName}}</view>
                    <view class="content-title">{{item.title}}</view>
                    <view class="content-detail">{{item.details}}</view>
                </view>
            </view>
        </view>
        <!-- Safety Footer -->
        <view wx:if="{{report}}" class="safety-footer">
            <view class="seal-logo">智汇 · 本草</view>
            <view class="safety-tips">本报告由区块链溯源系统底层支撑，保障数据真实不可篡改</view>
            <view class="report-id">报告唯一标识：{{report.batch.batchNo}}</view>
        </view>
    </view>
    <!-- Initial State -->
    <view class="initial-state" wx:if="{{!report && !loading}}">
        <view class="hero-placeholder">
            <view class="placeholder-icon">草</view>
        </view>
        <view class="placeholder-text">每一株草本，都有它的故事</view>
    </view>
</view>
