<view class="page-container">
    <view class="header">
        <view class="title">加工处理</view>
        <view class="desc">记录药材的烘干、切片、包装等工厂环节</view>
    </view>
    <!-- 筛选与操作 -->
    <view class="card">
        <view class="section-title">加工记录列表</view>
        <view class="search-bar">
            <input class="input-inline" placeholder="输入产出批次号查询" value="{{queryNo}}" bindinput="onQueryInput" />
            <button class="btn-small" bindtap="query">查询</button>
        </view>
        <!-- 核心操作区 -->
        <view class="proc-hero">
            <button class="btn btn-primary btn-hero" bindtap="onScanStart">扫码开工</button>
            <view class="proc-hint">推荐使用扫码直接进入产线作业模式</view>
        </view>
        <view class="btn-group" style="margin-bottom: 20rpx;">
            <button class="btn btn-outline" bindtap="startCreate">手工录入记录</button>
            <button class="btn btn-outline" bindtap="refreshList">刷新列表</button>
        </view>
        <!-- 列表内容 (源头批次) -->
        <view class="list" wx:if="{{batches && batches.length > 0}}">
            <view class="list-item proc-list-item" wx:for="{{batches}}" wx:key="id" bindtap="viewTrace" data-batch="{{item.batchNo}}">
                <view class="list-main">
                    <view class="list-title proc-list-title">
                        {{item.name}}
                        <text style="font-size: 24rpx; color: var(--text-sub); font-weight: normal; margin-left: 10rpx;">
                            {{item.category}}
                        </text>
                    </view>
                    <view class="list-sub proc-list-sub">
                        <view>批次号: {{item.batchNo}}</view>
                        <view style="margin-top: 4rpx;">产地: {{item.origin}}</view>
                    </view>
                </view>
                <view class="proc-list-right">
                    <view class="proc-list-pill">溯源 &gt;</view>
                    <view class="proc-list-meta">{{item.quantity}} {{item.unit}}</view>
                </view>
            </view>
        </view>
        <view class="empty" wx:if="{{(!batches || batches.length === 0) && !loading}}">暂无源头批次</view>
    </view>
</view>
